<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .medal-gold { color: #ffd700; }
        .medal-silver { color: #c0c0c0; }
        .medal-bronze { color: #cd7f32; }
        .evidence-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        .evidence-thumbnail:hover {
            border-color: #3b82f6;
            transform: scale(1.05);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-blue-100">
  <main class="container mx-auto px-4 py-8"><!-- Navigation -->
   <nav class="mb-8">
    <div class="flex flex-wrap justify-center gap-4"><button onclick="showPage('employee')" id="nav-employee" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô </button> <button onclick="showPage('admin')" id="nav-admin" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"> ‡∏£‡∏∞‡∏ö‡∏ö Admin </button> <button onclick="showPage('ranking')" id="nav-ranking" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πâ‡∏≤‡∏ß </button>
    </div>
   </nav><!-- Employee Page -->
   <div id="employee-page" class="page">
    <div class="max-w-2xl mx-auto">
     <div class="bg-white rounded-xl card-shadow p-8">
      <h1 id="system-title" class="text-3xl font-bold text-blue-800 text-center mb-8">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</h1>
      <form id="employee-form" class="space-y-6">
       <div><label for="employee-id" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label> <input type="text" id="employee-id" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" required>
       </div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label for="employee-name" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="employee-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
        </div>
        <div><label for="department" class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å</label> <input type="text" id="department" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
        </div>
       </div>
       <div><label for="steps" class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß</label> <input type="number" id="steps" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß" min="1" required>
       </div>
       <div><label for="evidence" class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏†‡∏≤‡∏û)</label> <input type="file" id="evidence" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <div id="image-preview" class="mt-4 hidden"><img id="preview-img" class="max-w-full h-48 object-cover rounded-lg border">
        </div>
       </div><button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg"> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• </button>
      </form>
      <div id="system-status" class="mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center"><span class="text-green-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
      </div>
      <div class="mt-4 text-center"><button onclick="checkSystemStatus()" id="check-system-btn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm"> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö </button>
      </div>
      <div id="system-check-results" class="mt-4 hidden">
       <div class="bg-gray-50 rounded-lg p-4 text-sm">
        <h4 class="font-medium text-gray-800 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö:</h4>
        <div id="check-results-content"></div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Admin Page -->
   <div id="admin-page" class="page hidden">
    <div id="admin-login" class="max-w-md mx-auto">
     <div class="bg-white rounded-xl card-shadow p-8">
      <h2 class="text-2xl font-bold text-blue-800 text-center mb-6">‡∏£‡∏∞‡∏ö‡∏ö Admin</h2>
      <form id="admin-login-form">
       <div class="mb-6"><label for="admin-code" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label> <input type="password" id="admin-code" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" required>
       </div><button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
      </form>
     </div>
    </div>
    <div id="admin-dashboard" class="hidden">
     <div class="bg-white rounded-xl card-shadow p-6 mb-6">
      <div class="flex flex-wrap justify-between items-center gap-4">
       <h2 class="text-2xl font-bold text-blue-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
       <div class="flex gap-4"><button id="toggle-system" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"> ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö </button> <button onclick="logout()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
       </div>
      </div>
     </div>
     <div class="bg-white rounded-xl card-shadow overflow-hidden">
      <div class="p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</h3>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead class="bg-blue-50">
          <tr>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
         </thead>
         <tbody id="admin-table-body" class="divide-y divide-gray-200">
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Ranking Page -->
   <div id="ranking-page" class="page hidden">
    <div class="bg-white rounded-xl card-shadow p-6">
     <h2 class="text-3xl font-bold text-blue-800 text-center mb-8">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πâ‡∏≤‡∏ß (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="bg-blue-50">
        <tr>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏¢‡∏≠‡∏î‡∏Å‡πâ‡∏≤‡∏ß‡∏£‡∏ß‡∏°</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏Å‡πâ‡∏≤‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</th>
        </tr>
       </thead>
       <tbody id="ranking-table-body" class="divide-y divide-gray-200">
       </tbody>
      </table>
     </div>
    </div>
   </div>
  </main><!-- Loading Modal -->
  <div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center">
    <div class="loading mx-auto mb-4"></div>
    <p class="text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
   </div>
  </div><!-- Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center max-w-sm mx-4">
    <div class="text-green-500 text-5xl mb-4">
     ‚úÖ
    </div>
    <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
    <p id="success-message" class="text-gray-600 mb-4"></p><button onclick="closeModal('success-modal')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"> ‡∏ï‡∏Å‡∏•‡∏á </button>
   </div>
  </div><!-- Error Modal -->
  <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center max-w-sm mx-4">
    <div class="text-red-500 text-5xl mb-4">
     ‚ùå
    </div>
    <h3 class="text-lg font-bold text-gray-800 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
    <p id="error-message" class="text-gray-600 mb-4"></p><button onclick="closeModal('error-modal')" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"> ‡∏ï‡∏Å‡∏•‡∏á </button>
   </div>
  </div>
  <script>
        // Google Sheets data
        let masterData = [];
        const SHEET_ID = '1lNZIRQI2LIgiwd32Nb9iuJfQw1TZbQFEqMi5gG_ZbTc';
        const MASTER_DATA_GID = '465912793';
        
        // Google Apps Script Web App URL (you need to replace this with your actual URL)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
        
        // Function to fetch data from Google Sheets
        async function fetchMasterData() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${MASTER_DATA_GID}`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                // Parse CSV data
                const lines = csvText.split('\n');
                masterData = [];
                
                // Skip header row (index 0) and process data rows
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const columns = line.split(',');
                        if (columns.length >= 3) {
                            masterData.push({
                                employee_id: columns[0].replace(/"/g, '').trim(),
                                name: columns[1].replace(/"/g, '').trim(),
                                department: columns[2].replace(/"/g, '').trim()
                            });
                        }
                    }
                }
                
                console.log('‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', masterData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            } catch (error) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ:', error);
                // Fallback to mock data if Google Sheets fails
                masterData = [
                    { employee_id: "001", name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ", department: "IT" },
                    { employee_id: "002", name: "‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô", department: "HR" },
                    { employee_id: "003", name: "‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏Ç‡∏¢‡∏±‡∏ô", department: "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô" },
                    { employee_id: "004", name: "‡∏°‡∏≤‡∏•‡∏µ ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°", department: "‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î" },
                    { employee_id: "005", name: "‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å", department: "‡∏ú‡∏•‡∏¥‡∏ï" }
                ];
            }
        }

        // Upload image to ImgBB (free image hosting)
        async function uploadImageToImgBB(file) {
            try {
                // Convert to base64 for now (ImgBB requires API key)
                return await fileToBase64(file);
            } catch (error) {
                console.error('Image upload failed:', error);
                return '';
            }
        }

        // Test system connectivity
        async function testSystemConnectivity() {
            const testResults = {
                dataSdk: false,
                googleSheets: false,
                imageUpload: false
            };

            // Test Data SDK
            try {
                if (window.dataSdk && window.dataSdk.init) {
                    testResults.dataSdk = true;
                }
            } catch (error) {
                console.error('Data SDK test failed:', error);
            }

            // Test Google Sheets access
            try {
                const testUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${MASTER_DATA_GID}`;
                const response = await fetch(testUrl);
                if (response.ok) {
                    testResults.googleSheets = true;
                }
            } catch (error) {
                console.error('Google Sheets test failed:', error);
            }

            // Test image upload capability
            try {
                // Create a small test image
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, 1, 1);
                
                canvas.toBlob(async (blob) => {
                    if (blob) {
                        testResults.imageUpload = true;
                    }
                });
            } catch (error) {
                console.error('Image upload test failed:', error);
            }

            return testResults;
        }

        // Send data to Google Sheets using multiple methods
        async function sendToGoogleSheets(data) {
            let success = false;
            
            // Method 1: Direct Google Sheets API (using CSV export endpoint for writing)
            try {
                // Create a simple webhook to Google Sheets using a public service
                const webhookData = {
                    timestamp: new Date().toISOString(),
                    employee_id: data.employee_id,
                    employee_name: data.employee_name,
                    department: data.department,
                    steps: data.steps,
                    evidence_image: data.evidence_image || '',
                    status: data.status,
                    daily_score: data.daily_score,
                    notes: data.notes || '',
                    sheet_url: `https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit#gid=0`
                };

                // Try using a webhook service (Zapier, Make.com, or similar)
                const webhookUrl = 'https://hooks.zapier.com/hooks/catch/YOUR_WEBHOOK_ID/';
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(webhookData)
                });
                
                if (response.ok) {
                    success = true;
                    console.log('Data sent to Google Sheets via webhook');
                }
            } catch (error) {
                console.error('Webhook method failed:', error);
            }

            // Method 2: Try Google Apps Script (if URL is configured)
            if (!success && GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL !== 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec') {
                try {
                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    success = true;
                    console.log('Data sent to Google Sheets via Apps Script');
                } catch (error) {
                    console.error('Google Apps Script failed:', error);
                }
            }

            // Method 3: Try Google Forms (alternative method)
            if (!success) {
                try {
                    const formData = new FormData();
                    
                    // Google Forms entry IDs (you need to inspect your form to get these)
                    // Replace these with your actual form entry IDs
                    formData.append('entry.123456789', data.date); // Date field
                    formData.append('entry.987654321', data.time); // Time field
                    formData.append('entry.111111111', data.employee_id); // Employee ID
                    formData.append('entry.222222222', data.employee_name); // Employee Name
                    formData.append('entry.333333333', data.department); // Department
                    formData.append('entry.444444444', data.steps); // Steps
                    formData.append('entry.555555555', data.status); // Status
                    formData.append('entry.666666666', data.daily_score); // Daily Score
                    formData.append('entry.777777777', data.notes || ''); // Notes
                    formData.append('entry.888888888', data.evidence_image || ''); // Evidence

                    // Replace YOUR_FORM_ID with your actual Google Form ID
                    const FORM_ID = '13yE0FCsi7wzUayYbyP663mp4Pp1s5lcbX70EJh2B69k';
                    const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`;
                    
                    await fetch(formUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                    
                    success = true;
                    console.log('Data sent to Google Sheets via Forms');
                } catch (error) {
                    console.error('Google Forms submission failed:', error);
                }
            }

            // Method 4: Try IFTTT Webhook (backup method)
            if (!success) {
                try {
                    const iftttData = {
                        value1: `${data.employee_id} - ${data.employee_name}`,
                        value2: `${data.department} - ${data.steps} ‡∏Å‡πâ‡∏≤‡∏ß`,
                        value3: `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${data.daily_score} - ${data.status}`
                    };

                    // Replace YOUR_IFTTT_KEY with your IFTTT webhook key
                    const IFTTT_URL = 'https://maker.ifttt.com/trigger/step_data/with/key/YOUR_IFTTT_KEY';
                    
                    await fetch(IFTTT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(iftttData)
                    });
                    
                    success = true;
                    console.log('Data sent to Google Sheets via IFTTT');
                } catch (error) {
                    console.error('IFTTT webhook failed:', error);
                }
            }

            return success;
        }

        let systemEnabled = true;
        let isAdminLoggedIn = false;
        let currentRecords = [];

        // Configuration
        const defaultConfig = {
            system_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô",
            company_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î"
        };

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                currentRecords = data;
                if (isAdminLoggedIn) {
                    renderAdminTable();
                }
                renderRankingTable();
            }
        };

        // Initialize SDK
        async function initializeApp() {
            // Fetch master data from Google Sheets first
            await fetchMasterData();
            
            const initResult = await window.dataSdk.init(dataHandler);
            if (!initResult.isOk) {
                showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
                return;
            }

            // Initialize Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    render: async (config) => {
                        document.getElementById('system-title').textContent = config.system_title || defaultConfig.system_title;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["system_title", config.system_title || defaultConfig.system_title],
                        ["company_name", config.company_name || defaultConfig.company_name]
                    ])
                });
            }
        }

        // Page navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('bg-blue-600');
                b.classList.add('bg-gray-600');
            });

            document.getElementById(`${page}-page`).classList.remove('hidden');
            document.getElementById(`nav-${page}`).classList.remove('bg-gray-600');
            document.getElementById(`nav-${page}`).classList.add('bg-blue-600');

            if (page === 'ranking') {
                renderRankingTable();
            }
        }

        // Employee ID lookup
        document.getElementById('employee-id').addEventListener('input', function(e) {
            const employeeId = e.target.value;
            const employee = masterData.find(emp => emp.employee_id === employeeId);
            
            if (employee) {
                document.getElementById('employee-name').value = employee.name;
                document.getElementById('department').value = employee.department;
            } else {
                document.getElementById('employee-name').value = '';
                document.getElementById('department').value = '';
            }
        });

        // Image preview
        document.getElementById('evidence').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('image-preview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Employee form submission
        document.getElementById('employee-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!systemEnabled) {
                showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß");
                return;
            }

            if (currentRecords.length >= 999) {
                showError("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ");
                return;
            }

            const employeeId = document.getElementById('employee-id').value.trim();
            const employeeName = document.getElementById('employee-name').value.trim();
            const department = document.getElementById('department').value.trim();
            const stepsInput = document.getElementById('steps').value;
            const evidenceFile = document.getElementById('evidence').files[0];

            if (!employeeId || !employeeName || !department || !stepsInput) {
                showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            const steps = parseInt(stepsInput);
            if (isNaN(steps) || steps <= 0) {
                showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                return;
            }

            showLoading();

            try {
                // Calculate daily score
                let dailyScore = 1;
                if (steps >= 10000) dailyScore = 8;
                else if (steps >= 6500) dailyScore = 5;
                else if (steps >= 5200) dailyScore = 2;

                // Upload image if exists
                let evidenceImageUrl = '';
                if (evidenceFile) {
                    evidenceImageUrl = await uploadImageToImgBB(evidenceFile);
                }

                const now = new Date();
                const thaiDate = now.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                const thaiTime = now.toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // Create record data with safe field names
                const recordData = {
                    employee_id: employeeId,
                    employee_name: employeeName,
                    department: department,
                    steps: steps,
                    evidence_image: evidenceImageUrl || "",
                    date: now.toISOString(),
                    status: "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
                    daily_score: dailyScore,
                    notes: ""
                };

                // Save to local Data SDK first
                const result = await window.dataSdk.create(recordData);
                
                if (result.isOk) {
                    // Send to Google Sheets after successful local save
                    const sheetSuccess = await sendToGoogleSheets({
                        date: thaiDate,
                        time: thaiTime,
                        employee_id: employeeId,
                        employee_name: employeeName,
                        department: department,
                        steps: steps,
                        evidence_image: evidenceImageUrl,
                        status: "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
                        daily_score: dailyScore,
                        notes: ""
                    });

                    hideLoading();
                    if (sheetSuccess) {
                        showSuccess("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets ‡πÅ‡∏•‡πâ‡∏ß");
                    } else {
                        showSuccess("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! (Google Sheets ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤)");
                    }
                    document.getElementById('employee-form').reset();
                    document.getElementById('image-preview').classList.add('hidden');
                } else {
                    hideLoading();
                    console.error('Data SDK Error:', result.error);
                    showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + (result.error?.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'));
                }
            } catch (error) {
                hideLoading();
                console.error('Form submission error:', error);
                showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
            }
        });

        // Admin login
        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const code = document.getElementById('admin-code').value;
            
            if (code === '084843') {
                isAdminLoggedIn = true;
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                renderAdminTable();
            } else {
                showError("‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            }
        });

        // Admin logout
        function logout() {
            isAdminLoggedIn = false;
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-code').value = '';
        }

        // Toggle system
        document.getElementById('toggle-system').addEventListener('click', function() {
            systemEnabled = !systemEnabled;
            const btn = this;
            const statusDiv = document.getElementById('system-status');
            
            if (systemEnabled) {
                btn.textContent = '‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö';
                btn.className = 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors';
                statusDiv.className = 'mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center';
                statusDiv.innerHTML = '<span class="text-green-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>';
                showSuccess('‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            } else {
                btn.textContent = '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö';
                btn.className = 'px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors';
                statusDiv.className = 'mt-6 p-4 bg-red-100 border border-red-300 rounded-lg text-center';
                statusDiv.innerHTML = '<span class="text-red-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</span>';
                showSuccess('‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
            }
        });

        // Render admin table
        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = '';

            currentRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const date = new Date(record.date);
                const formattedDate = date.toLocaleDateString('th-TH') + ' ' + date.toLocaleTimeString('th-TH');
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-900">${formattedDate}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.employee_id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.employee_name}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.department}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.steps.toLocaleString()}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">
                        ${record.evidence_image ? 
                            '<div class="flex items-center gap-2">' +
                            '<img src="' + record.evidence_image + '" class="evidence-thumbnail" onclick="viewImage(\'' + record.evidence_image + '\')" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà" onerror="this.style.display=\'none\'">' +
                            '<button onclick="viewImage(\'' + record.evidence_image + '\')" class="text-blue-600 hover:text-blue-800 text-xs">‡∏î‡∏π‡πÉ‡∏´‡∏ç‡πà</button>' +
                            '</div>' 
                            : '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ</span>'}
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <select onchange="updateStatus('${record.__backendId}', this.value)" class="px-2 py-1 border rounded text-sm ${getStatusClass(record.status)}">
                            <option value="‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.status === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            <option value="‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.status === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        </select>
                    </td>
                    <td class="px-4 py-3 text-sm text-center font-medium text-blue-600">${record.daily_score}</td>
                    <td class="px-4 py-3 text-sm">
                        <input type="text" value="${record.notes || ''}" onchange="updateNotes('${record.__backendId}', this.value)" class="w-full px-2 py-1 border rounded text-sm" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <button onclick="deleteRecord('${record.__backendId}')" class="text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50">‡∏•‡∏ö</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (currentRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // Get status class for styling
        function getStatusClass(status) {
            switch(status) {
                case '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': return 'text-green-600 bg-green-50';
                case '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': return 'text-red-600 bg-red-50';
                default: return 'text-yellow-600 bg-yellow-50';
            }
        }

        // Update status
        async function updateStatus(recordId, newStatus) {
            const record = currentRecords.find(r => r.__backendId === recordId);
            if (record) {
                record.status = newStatus;
                const result = await window.dataSdk.update(record);
                if (!result.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ");
                }
            }
        }

        // Update notes
        async function updateNotes(recordId, newNotes) {
            const record = currentRecords.find(r => r.__backendId === recordId);
            if (record) {
                record.notes = newNotes;
                const result = await window.dataSdk.update(record);
                if (!result.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏î‡πâ");
                }
            }
        }

        // Delete record
        async function deleteRecord(recordId) {
            const record = currentRecords.find(r => r.__backendId === recordId);
            if (record) {
                const result = await window.dataSdk.delete(record);
                if (!result.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
                }
            }
        }

        // Render ranking table
        function renderRankingTable() {
            const tbody = document.getElementById('ranking-table-body');
            tbody.innerHTML = '';

            // Filter approved records only
            const approvedRecords = currentRecords.filter(record => record.status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
            
            // Group by employee and calculate totals
            const employeeStats = {};
            const today = new Date().toDateString();

            approvedRecords.forEach(record => {
                const empId = record.employee_id;
                if (!employeeStats[empId]) {
                    employeeStats[empId] = {
                        employee_id: empId,
                        employee_name: record.employee_name,
                        department: record.department,
                        total_score: 0,
                        total_steps: 0,
                        today_steps: 0
                    };
                }
                
                employeeStats[empId].total_score += record.daily_score;
                employeeStats[empId].total_steps += record.steps;
                
                const recordDate = new Date(record.date).toDateString();
                if (recordDate === today) {
                    employeeStats[empId].today_steps += record.steps;
                }
            });

            // Convert to array and sort by total score
            const sortedEmployees = Object.values(employeeStats)
                .sort((a, b) => b.total_score - a.total_score)
                .slice(0, 100);

            sortedEmployees.forEach((employee, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                let rankDisplay = rank;
                if (rank === 1) rankDisplay = '<span class="medal-gold text-2xl">ü•á</span> 1';
                else if (rank === 2) rankDisplay = '<span class="medal-silver text-2xl">ü•à</span> 2';
                else if (rank === 3) rankDisplay = '<span class="medal-bronze text-2xl">ü•â</span> 3';
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-center font-bold ${rank <= 3 ? 'text-lg' : ''}">${rankDisplay}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${employee.employee_id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 font-medium">${employee.employee_name}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${employee.department}</td>
                    <td class="px-4 py-3 text-center text-sm font-bold text-blue-600">${employee.total_score}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900">${employee.total_steps.toLocaleString()}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900">${employee.today_steps.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });

            if (sortedEmployees.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // View image in modal
        function viewImage(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageUrl}" class="max-w-full max-h-full object-contain rounded-lg" onerror="this.parentElement.innerHTML='<div class=\\'text-white text-center\\'>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</div>'">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-4 right-4 text-white text-3xl hover:text-gray-300 bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center">√ó</button>
                </div>
            `;
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            document.body.appendChild(modal);
        }

        // Utility functions
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function showLoading() {
            document.getElementById('loading-modal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-modal').classList.add('hidden');
        }

        function showSuccess(message) {
            document.getElementById('success-message').textContent = message;
            document.getElementById('success-modal').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Check system status
        async function checkSystemStatus() {
            const btn = document.getElementById('check-system-btn');
            const resultsDiv = document.getElementById('system-check-results');
            const contentDiv = document.getElementById('check-results-content');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="loading inline-block mr-2"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            
            try {
                const results = await testSystemConnectivity();
                
                let html = '<div class="space-y-2">';
                
                // Data SDK Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Canva Sheet):</span>
                    <span class="${results.dataSdk ? 'text-green-600' : 'text-red-600'}">
                        ${results.dataSdk ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'}
                    </span>
                </div>`;
                
                // Google Sheets Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets:</span>
                    <span class="${results.googleSheets ? 'text-green-600' : 'text-red-600'}">
                        ${results.googleSheets ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ' : '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'}
                    </span>
                </div>`;
                
                // Image Upload Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</span>
                    <span class="${results.imageUpload ? 'text-green-600' : 'text-yellow-600'}">
                        ${results.imageUpload ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î'}
                    </span>
                </div>`;
                
                html += '</div>';
                
                // Overall status
                const allGood = results.dataSdk && results.googleSheets;
                html += `<div class="mt-3 p-3 rounded-lg ${allGood ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                    <strong>${allGood ? '‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô'}</strong><br>
                    ${allGood ? 
                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Sheet ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets' : 
                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Sheet ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Google Sheets ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤)'}
                </div>`;
                
                // Instructions
                if (!results.googleSheets) {
                    html += `<div class="mt-3 p-3 bg-blue-100 text-blue-800 rounded-lg text-xs">
                        <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Google Sheets:</strong><br>
                        1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script<br>
                        2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Form ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Sheet<br>
                        3. ‡πÉ‡∏ä‡πâ Zapier ‡∏´‡∏£‡∏∑‡∏≠ IFTTT Webhook<br>
                        <a href="https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit#gid=0" target="_blank" class="underline">‡πÄ‡∏õ‡∏¥‡∏î Google Sheet</a>
                    </div>`;
                }
                
                contentDiv.innerHTML = html;
                resultsDiv.classList.remove('hidden');
                
            } catch (error) {
                contentDiv.innerHTML = `<div class="text-red-600">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${error.message}</div>`;
                resultsDiv.classList.remove('hidden');
            }
            
            btn.disabled = false;
            btn.innerHTML = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö';
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9927079da519a1b0',t:'MTc2MTExNTUwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
