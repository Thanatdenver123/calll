<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Sarabun', 'Noto Sans Thai', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .medal-gold { color: #ffd700; }
        .medal-silver { color: #c0c0c0; }
        .medal-bronze { color: #cd7f32; }
        .evidence-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        .evidence-thumbnail:hover {
            border-color: #3b82f6;
            transform: scale(1.05);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-blue-100">
  <main class="container mx-auto px-4 py-8"><!-- Navigation -->
   <nav class="mb-8">
    <div class="flex flex-wrap justify-center gap-4"><button onclick="showPage('employee')" id="nav-employee" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô </button> <button onclick="showPage('admin')" id="nav-admin" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"> ‡∏£‡∏∞‡∏ö‡∏ö Admin </button> <button onclick="showPage('ranking')" id="nav-ranking" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πâ‡∏≤‡∏ß </button>
    </div>
   </nav><!-- Employee Page -->
   <div id="employee-page" class="page">
    <div class="max-w-2xl mx-auto">
     <div class="bg-white rounded-xl card-shadow p-8">
      <h1 id="system-title" class="text-3xl font-bold text-blue-800 text-center mb-8">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</h1>
      <form id="employee-form" class="space-y-6">
       <div><label for="employee-id" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label> <input type="text" id="employee-id" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" required>
       </div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label for="employee-name" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="employee-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
        </div>
        <div><label for="department" class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å</label> <input type="text" id="department" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
        </div>
       </div>
       <div><label for="steps" class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß</label> <input type="number" id="steps" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß" min="1" required>
       </div>
       <div><label for="evidence" class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏†‡∏≤‡∏û)</label> <input type="file" id="evidence" accept="image/*" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <div class="mt-2 text-xs text-gray-500">
         üí° <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, WebP
        </div>
        <div id="image-preview" class="mt-4 hidden"><img id="preview-img" class="max-w-full h-48 object-cover rounded-lg border">
        </div>
       </div><button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg"> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• </button>
      </form>
      <div id="system-status" class="mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center"><span class="text-green-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
      </div>
      <div class="mt-4 text-center">
       <div class="flex flex-wrap gap-2 justify-center"><button onclick="checkSystemStatus()" id="check-system-btn" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm"> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö </button> <button onclick="showServerConfig()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå </button>
       </div>
      </div>
      <div id="system-check-results" class="mt-4 hidden">
       <div class="bg-gray-50 rounded-lg p-4 text-sm">
        <h4 class="font-medium text-gray-800 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö:</h4>
        <div id="check-results-content"></div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Admin Page -->
   <div id="admin-page" class="page hidden">
    <div id="admin-login" class="max-w-md mx-auto">
     <div class="bg-white rounded-xl card-shadow p-8">
      <h2 class="text-2xl font-bold text-blue-800 text-center mb-6">‡∏£‡∏∞‡∏ö‡∏ö Admin</h2>
      <form id="admin-login-form">
       <div class="mb-6"><label for="admin-code" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label> <input type="password" id="admin-code" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" required>
       </div><button type="submit" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
      </form>
     </div>
    </div>
    <div id="admin-dashboard" class="hidden">
     <div class="bg-white rounded-xl card-shadow p-6 mb-6">
      <div class="flex flex-wrap justify-between items-center gap-4">
       <h2 class="text-2xl font-bold text-blue-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
       <div class="flex flex-wrap gap-4"><button onclick="exportToExcel()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"> üìä ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel </button> <button id="toggle-system" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"> ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö </button> <button onclick="clearAllData()" class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"> Clear ‡∏£‡∏∞‡∏ö‡∏ö </button> <button onclick="logout()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
       </div>
      </div>
     </div>
     <div class="bg-white rounded-xl card-shadow overflow-hidden">
      <div class="p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô</h3>
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead class="bg-blue-50">
          <tr>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
           <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
         </thead>
         <tbody id="admin-table-body" class="divide-y divide-gray-200">
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Ranking Page -->
   <div id="ranking-page" class="page hidden">
    <div class="bg-white rounded-xl card-shadow p-6">
     <div class="flex flex-wrap justify-between items-center mb-8">
      <h2 class="text-3xl font-bold text-blue-800">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πâ‡∏≤‡∏ß</h2><button onclick="exportRankingToExcel()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"> üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö Excel </button>
     </div>
     <p class="text-center text-gray-600 mb-6">(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß)</p>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="bg-blue-50">
        <tr>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠</th>
         <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏¢‡∏≠‡∏î‡∏Å‡πâ‡∏≤‡∏ß‡∏£‡∏ß‡∏°</th>
         <th class="px-4 py-3 text-center text-sm font-medium text-gray-700">‡∏Å‡πâ‡∏≤‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</th>
        </tr>
       </thead>
       <tbody id="ranking-table-body" class="divide-y divide-gray-200">
       </tbody>
      </table>
     </div>
    </div>
   </div>
  </main><!-- Loading Modal -->
  <div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center">
    <div class="loading mx-auto mb-4"></div>
    <p class="text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
   </div>
  </div><!-- Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center max-w-sm mx-4">
    <div class="text-green-500 text-5xl mb-4">
     ‚úÖ
    </div>
    <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
    <p id="success-message" class="text-gray-600 mb-4"></p><button onclick="closeModal('success-modal')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"> ‡∏ï‡∏Å‡∏•‡∏á </button>
   </div>
  </div><!-- Error Modal -->
  <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
   <div class="bg-white rounded-lg p-6 text-center max-w-sm mx-4">
    <div class="text-red-500 text-5xl mb-4">
     ‚ùå
    </div>
    <h3 class="text-lg font-bold text-gray-800 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
    <p id="error-message" class="text-gray-600 mb-4"></p><button onclick="closeModal('error-modal')" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"> ‡∏ï‡∏Å‡∏•‡∏á </button>
   </div>
  </div>
  <script>
        // Google Sheets data
        let masterData = [];
        const SHEET_ID = '1lNZIRQI2LIgiwd32Nb9iuJfQw1TZbQFEqMi5gG_ZbTc';
        const MASTER_DATA_GID = '465912793';
        
        // Google Apps Script Web App URL (you need to replace this with your actual URL)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
        
        // Function to fetch data from Google Sheets
        async function fetchMasterData() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${MASTER_DATA_GID}`;
                const response = await fetch(url);
                const csvText = await response.text();
                
                // Parse CSV data
                const lines = csvText.split('\n');
                masterData = [];
                
                // Skip header row (index 0) and process data rows
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const columns = line.split(',');
                        if (columns.length >= 3) {
                            masterData.push({
                                employee_id: columns[0].replace(/"/g, '').trim(),
                                name: columns[1].replace(/"/g, '').trim(),
                                department: columns[2].replace(/"/g, '').trim()
                            });
                        }
                    }
                }
                
                console.log('‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', masterData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            } catch (error) {
                console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ:', error);
                // Fallback to mock data if Google Sheets fails
                masterData = [
                    { employee_id: "001", name: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ", department: "IT" },
                    { employee_id: "002", name: "‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏á‡∏≤‡∏ô", department: "HR" },
                    { employee_id: "003", name: "‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏Ç‡∏¢‡∏±‡∏ô", department: "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô" },
                    { employee_id: "004", name: "‡∏°‡∏≤‡∏•‡∏µ ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°", department: "‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î" },
                    { employee_id: "005", name: "‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å", department: "‡∏ú‡∏•‡∏¥‡∏ï" }
                ];
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        function validateImageFile(file) {
            const result = { isValid: false, message: '' };
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (8MB ‡∏ï‡∏≤‡∏° php.ini)
            const MAX_FILE_SIZE = 8 * 1024 * 1024; // 8MB
            if (file.size > MAX_FILE_SIZE) {
                result.message = `‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (${(file.size / 1024 / 1024).toFixed(1)} MB)\n‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï: 8 MB\n\nüí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:\n‚Ä¢ ‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û\n‚Ä¢ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û\n‚Ä¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå JPG`;
                return result;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå (MIME Type)
            const allowedTypes = [
                'image/jpeg',
                'image/jpg', 
                'image/png',
                'image/webp',
                'image/gif'
            ];
            
            if (!allowedTypes.includes(file.type)) {
                result.message = `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: ${file.type}\n\n‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:\n‚Ä¢ JPG/JPEG\n‚Ä¢ PNG\n‚Ä¢ WebP\n‚Ä¢ GIF`;
                return result;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
            const fileName = file.name.toLowerCase();
            const allowedExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif'];
            const hasValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));
            
            if (!hasValidExtension) {
                result.message = `‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${file.name}\n\n‚úÖ ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:\n‚Ä¢ .jpg, .jpeg\n‚Ä¢ .png\n‚Ä¢ .webp\n‚Ä¢ .gif`;
                return result;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
            const dangerousPatterns = [
                /\.php/i, /\.js/i, /\.html/i, /\.htm/i, 
                /\.asp/i, /\.jsp/i, /\.exe/i, /\.bat/i,
                /\.sh/i, /\.cmd/i, /\.scr/i
            ];
            
            if (dangerousPatterns.some(pattern => pattern.test(fileName))) {
                result.message = `‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: ${file.name}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤`;
                return result;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á
            if (file.size === 0) {
                result.message = '‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                return result;
            }
            
            // ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            result.isValid = true;
            return result;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
        async function testImageCompression(file) {
            try {
                const compressedBase64 = await processImageForStorage(file);
                
                if (!compressedBase64) {
                    return { 
                        success: false, 
                        error: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏î‡πâ' 
                    };
                }
                
                const originalSizeKB = (file.size / 1024);
                const compressedSizeKB = (compressedBase64.length / 1024);
                const compressionRatio = ((1 - compressedSizeKB / originalSizeKB) * 100);
                
                return {
                    success: true,
                    originalSize: originalSizeKB.toFixed(1),
                    finalSize: compressedSizeKB.toFixed(1),
                    compressionRatio: compressionRatio.toFixed(1),
                    compressedData: compressedBase64
                };
                
            } catch (error) {
                return { 
                    success: false, 
                    error: error.message 
                };
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
        function checkServerLimits() {
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏ï‡∏≤‡∏° php.ini)
            const serverLimits = {
                upload_max_filesize: '8M',
                post_max_size: '8M',
                max_execution_time: '60s',
                max_input_time: '60s'
            };
            
            console.log('üìã ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:');
            console.log('upload_max_filesize =', serverLimits.upload_max_filesize);
            console.log('post_max_size =', serverLimits.post_max_size);
            console.log('max_execution_time =', serverLimits.max_execution_time);
            console.log('max_input_time =', serverLimits.max_input_time);
            
            return serverLimits;
        }

        // Upload image with aggressive compression
        async function uploadImageToImgBB(file) {
            try {
                console.log(`üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
                
                // Step 1: Compress image aggressively
                const compressedFile = await compressImageAggressively(file);
                if (!compressedFile) {
                    console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ');
                    return '';
                }
                
                // Method 1: Try ImgBB API (requires API key)
                const API_KEY = 'YOUR_IMGBB_API_KEY'; // Replace with actual API key
                
                if (API_KEY && API_KEY !== 'YOUR_IMGBB_API_KEY') {
                    const formData = new FormData();
                    formData.append('image', compressedFile);
                    formData.append('key', API_KEY);
                    
                    const response = await fetch('https://api.imgbb.com/1/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            return result.data.url;
                        }
                    }
                }
                
                // Method 2: Use Cloudinary (free tier)
                try {
                    const cloudinaryFormData = new FormData();
                    cloudinaryFormData.append('file', compressedFile);
                    cloudinaryFormData.append('upload_preset', 'ml_default'); // Use unsigned preset
                    
                    const cloudinaryResponse = await fetch('https://api.cloudinary.com/v1_1/demo/image/upload', {
                        method: 'POST',
                        body: cloudinaryFormData
                    });
                    
                    if (cloudinaryResponse.ok) {
                        const cloudinaryResult = await cloudinaryResponse.json();
                        return cloudinaryResult.secure_url;
                    }
                } catch (cloudinaryError) {
                    console.warn('Cloudinary upload failed:', cloudinaryError);
                }
                
                // Method 3: Create a very small base64 thumbnail (max 10KB)
                console.log('Using compressed base64 fallback');
                const thumbnailBase64 = await createThumbnail(file, 200, 150, 0.3);
                
                if (thumbnailBase64.length < 15000) { // Less than 15KB
                    return thumbnailBase64;
                } else {
                    console.warn('‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ');
                    return '';
                }
                
            } catch (error) {
                console.error('Image upload failed:', error);
                return '';
            }
        }

        // Compress image aggressively
        async function compressImageAggressively(file) {
            return new Promise((resolve) => {
                if (file.size > 5 * 1024 * 1024) { // > 5MB
                    console.warn('‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB');
                    resolve(null);
                    return;
                }

                const reader = new FileReader();
                reader.readAsDataURL(file);
                
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        
                        // Very aggressive compression: max 400x300, quality 20%
                        let { width, height } = calculateDimensions(img.width, img.height, 400, 300);
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Convert to very low quality JPEG
                        canvas.toBlob((blob) => {
                            if (blob && blob.size < 100 * 1024) { // Less than 100KB
                                console.log(`‚úÖ ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${(blob.size / 1024).toFixed(1)} KB (${width}x${height})`);
                                resolve(blob);
                            } else {
                                // If still too big, make it even smaller
                                const smallerDimensions = calculateDimensions(width, height, 200, 150);
                                canvas.width = smallerDimensions.width;
                                canvas.height = smallerDimensions.height;
                                ctx.drawImage(img, 0, 0, smallerDimensions.width, smallerDimensions.height);
                                
                                canvas.toBlob((smallerBlob) => {
                                    if (smallerBlob) {
                                        console.log(`‚úÖ ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ${(smallerBlob.size / 1024).toFixed(1)} KB (${smallerDimensions.width}x${smallerDimensions.height})`);
                                        resolve(smallerBlob);
                                    } else {
                                        resolve(null);
                                    }
                                }, 'image/jpeg', 0.1); // Very low quality
                            }
                        }, 'image/jpeg', 0.2); // Low quality
                    };
                    
                    img.onerror = () => resolve(null);
                };
                
                reader.onerror = () => resolve(null);
            });
        }

        // Create thumbnail
        async function createThumbnail(file, maxWidth = 200, maxHeight = 150, quality = 0.3) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const { width, height } = calculateDimensions(img.width, img.height, maxWidth, maxHeight);
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const thumbnailBase64 = canvas.toDataURL('image/jpeg', quality);
                        console.log(`üñºÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á Thumbnail: ${(thumbnailBase64.length / 1024).toFixed(1)} KB (${width}x${height})`);
                        resolve(thumbnailBase64);
                    };
                    
                    img.onerror = () => resolve('');
                };
                
                reader.onerror = () => resolve('');
            });
        }

        // Calculate dimensions maintaining aspect ratio
        function calculateDimensions(originalWidth, originalHeight, maxWidth, maxHeight) {
            let width = originalWidth;
            let height = originalHeight;
            
            if (width > height) {
                if (width > maxWidth) {
                    height = Math.round((height * maxWidth) / width);
                    width = maxWidth;
                }
            } else {
                if (height > maxHeight) {
                    width = Math.round((width * maxHeight) / height);
                    height = maxHeight;
                }
            }
            
            return { width, height };
        }

        // Test system connectivity
        async function testSystemConnectivity() {
            const testResults = {
                dataSdk: false,
                googleSheets: false,
                imageUpload: false
            };

            // Test Data SDK
            try {
                if (window.dataSdk && window.dataSdk.init) {
                    testResults.dataSdk = true;
                }
            } catch (error) {
                console.error('Data SDK test failed:', error);
            }

            // Test Google Sheets access
            try {
                const testUrl = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${MASTER_DATA_GID}`;
                const response = await fetch(testUrl);
                if (response.ok) {
                    testResults.googleSheets = true;
                }
            } catch (error) {
                console.error('Google Sheets test failed:', error);
            }

            // Test image upload capability
            try {
                // Create a small test image
                const canvas = document.createElement('canvas');
                canvas.width = 1;
                canvas.height = 1;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, 1, 1);
                
                canvas.toBlob(async (blob) => {
                    if (blob) {
                        testResults.imageUpload = true;
                    }
                });
            } catch (error) {
                console.error('Image upload test failed:', error);
            }

            return testResults;
        }

        // Send data to Google Sheets using Google Apps Script
        async function sendToGoogleSheets(data) {
            try {
                // Google Apps Script Web App URL for the specific sheet
                const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYOUR_SCRIPT_ID_HERE/exec';
                
                const payload = {
                    action: 'addRecord',
                    sheetId: SHEET_ID,
                    data: {
                        timestamp: new Date().toISOString(),
                        date: data.date,
                        time: data.time,
                        employee_id: data.employee_id,
                        employee_name: data.employee_name,
                        department: data.department,
                        steps: data.steps,
                        evidence: data.evidence_url || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô',
                        status: data.status,
                        daily_score: data.daily_score,
                        notes: data.notes || ''
                    }
                };

                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets:', payload);

                // Try to send to Google Apps Script
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                // Since mode is 'no-cors', we can't check response status
                // Assume success if no error is thrown
                console.log('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÅ‡∏•‡πâ‡∏ß');
                return true;

            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets ‡πÑ‡∏î‡πâ:', error);
                
                // Try alternative method using Google Forms
                try {
                    const formData = new FormData();
                    
                    // You need to create a Google Form connected to your sheet
                    // and replace these entry IDs with your actual form field IDs
                    formData.append('entry.1234567890', data.date); // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                    formData.append('entry.0987654321', data.time); // ‡πÄ‡∏ß‡∏•‡∏≤
                    formData.append('entry.1111111111', data.employee_id); // ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    formData.append('entry.2222222222', data.employee_name); // ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•
                    formData.append('entry.3333333333', data.department); // ‡πÅ‡∏ú‡∏ô‡∏Å
                    formData.append('entry.4444444444', data.steps); // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß
                    formData.append('entry.5555555555', data.status); // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    formData.append('entry.6666666666', data.daily_score); // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô

                    // Replace with your actual Google Form ID
                    const FORM_ID = '1FAIpQLSe_YOUR_ACTUAL_FORM_ID_HERE';
                    const formUrl = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`;
                    
                    await fetch(formUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });
                    
                    console.log('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Google Forms ‡πÅ‡∏•‡πâ‡∏ß');
                    return true;
                    
                } catch (formError) {
                    console.error('‚ùå Google Forms ‡∏Å‡πá‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', formError);
                    return false;
                }
            }
        }

        let systemEnabled = true;
        let isAdminLoggedIn = false;
        let currentRecords = [];

        // Configuration
        const defaultConfig = {
            system_title: "‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô",
            company_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC ‡∏à‡∏≥‡∏Å‡∏±‡∏î"
        };

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                currentRecords = data;
                if (isAdminLoggedIn) {
                    renderAdminTable();
                }
                renderRankingTable();
            }
        };

        // Initialize SDK
        async function initializeApp() {
            // Fetch master data from Google Sheets first
            await fetchMasterData();
            
            // Wait for SDK to be available
            let attempts = 0;
            const maxAttempts = 50; // 5 seconds max wait
            
            while (!window.dataSdk && attempts < maxAttempts) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            if (!window.dataSdk) {
                showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Data SDK ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö");
                return;
            }
            
            try {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: " + (initResult.error?.message || 'Unknown error'));
                    return;
                }
                
                console.log('‚úÖ Data SDK ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                console.error('Data SDK initialization error:', error);
                showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message);
                return;
            }

            // Initialize Element SDK
            if (window.elementSdk) {
                try {
                    await window.elementSdk.init({
                        defaultConfig,
                        render: async (config) => {
                            const titleElement = document.getElementById('system-title');
                            if (titleElement) {
                                titleElement.textContent = config.system_title || defaultConfig.system_title;
                            }
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["system_title", config.system_title || defaultConfig.system_title],
                            ["company_name", config.company_name || defaultConfig.company_name]
                        ])
                    });
                    console.log('‚úÖ Element SDK ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } catch (error) {
                    console.warn('Element SDK initialization failed:', error);
                }
            }
        }

        // Page navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => {
                b.classList.remove('bg-blue-600');
                b.classList.add('bg-gray-600');
            });

            document.getElementById(`${page}-page`).classList.remove('hidden');
            document.getElementById(`nav-${page}`).classList.remove('bg-gray-600');
            document.getElementById(`nav-${page}`).classList.add('bg-blue-600');

            if (page === 'ranking') {
                renderRankingTable();
            }
        }

        // Employee ID lookup
        document.getElementById('employee-id').addEventListener('input', function(e) {
            const employeeId = e.target.value;
            const employee = masterData.find(emp => emp.employee_id === employeeId);
            
            if (employee) {
                document.getElementById('employee-name').value = employee.name;
                document.getElementById('department').value = employee.department;
            } else {
                document.getElementById('employee-name').value = '';
                document.getElementById('department').value = '';
            }
        });

        // Enhanced image validation and preview
        document.getElementById('evidence').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            const previewDiv = document.getElementById('image-preview');
            
            if (!file) {
                previewDiv.classList.add('hidden');
                return;
            }

            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå
            const validationResult = validateImageFile(file);
            if (!validationResult.isValid) {
                showError(validationResult.message);
                e.target.value = ''; // Clear file input
                previewDiv.classList.add('hidden');
                return;
            }

            const fileSize = (file.size / 1024).toFixed(1);
            const fileType = file.type;
            
            console.log(`‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${file.name} (${fileSize} KB, ${fileType})`);
            
            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
            let statusText = '';
            let statusClass = '';
            
            if (file.size > 2000000) { // > 2MB
                statusText = 'üîÑ ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å - ‡∏à‡∏∞‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏´‡∏ô‡∏±‡∏Å (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5-10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)';
                statusClass = 'bg-red-100 border-red-300 text-red-800';
            } else if (file.size > 1000000) { // > 1MB
                statusText = 'üîÑ ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà - ‡∏à‡∏∞‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2-3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)';
                statusClass = 'bg-yellow-100 border-yellow-300 text-yellow-800';
            } else if (file.size > 500000) { // > 500KB
                statusText = 'üîÑ ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á - ‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢';
                statusClass = 'bg-blue-100 border-blue-300 text-blue-800';
            } else {
                statusText = '‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                statusClass = 'bg-green-100 border-green-300 text-green-800';
            }

            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            const reader = new FileReader();
            reader.onload = function(e) {
                previewDiv.innerHTML = `
                    <img id="preview-img" src="${e.target.result}" class="max-w-full h-48 object-cover rounded-lg border">
                    <div class="mt-2 text-sm text-gray-600">
                        üìÅ ${file.name} | üìè ${fileSize} KB | üñºÔ∏è ${fileType}
                    </div>
                    <div class="mt-2 p-2 ${statusClass} border rounded text-sm">
                        ${statusText}
                    </div>
                    <div id="compression-progress" class="mt-2 hidden">
                        <div class="flex items-center space-x-2">
                            <div class="loading"></div>
                            <span class="text-sm text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span>
                        </div>
                    </div>
                `;
                previewDiv.classList.remove('hidden');
            };
            reader.readAsDataURL(file);

            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà)
            if (file.size > 500000) {
                try {
                    document.getElementById('compression-progress').classList.remove('hidden');
                    const compressedResult = await testImageCompression(file);
                    document.getElementById('compression-progress').classList.add('hidden');
                    
                    if (compressedResult.success) {
                        const compressionInfo = document.createElement('div');
                        compressionInfo.className = 'mt-2 p-2 bg-green-100 border border-green-300 rounded text-sm text-green-800';
                        compressionInfo.innerHTML = `
                            ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br>
                            üìä ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î: ${compressedResult.finalSize} KB<br>
                            üìâ ‡∏•‡∏î‡∏•‡∏á: ${compressedResult.compressionRatio}%
                        `;
                        previewDiv.appendChild(compressionInfo);
                    } else {
                        const errorInfo = document.createElement('div');
                        errorInfo.className = 'mt-2 p-2 bg-red-100 border border-red-300 rounded text-sm text-red-800';
                        errorInfo.innerHTML = `‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏î‡πâ: ${compressedResult.error}`;
                        previewDiv.appendChild(errorInfo);
                    }
                } catch (error) {
                    document.getElementById('compression-progress').classList.add('hidden');
                    console.warn('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                }
            }
        });

        // Employee form submission
        document.getElementById('employee-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!systemEnabled) {
                showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß");
                return;
            }

            if (currentRecords.length >= 999) {
                showError("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ");
                return;
            }

            const employeeId = document.getElementById('employee-id').value.trim();
            const employeeName = document.getElementById('employee-name').value.trim();
            const department = document.getElementById('department').value.trim();
            const stepsInput = document.getElementById('steps').value;
            const evidenceFile = document.getElementById('evidence').files[0];

            if (!employeeId || !employeeName || !department || !stepsInput) {
                showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            const steps = parseInt(stepsInput);
            if (isNaN(steps) || steps <= 0) {
                showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                return;
            }

            showLoading();

            try {
                // Calculate daily score
                let dailyScore = 1;
                if (steps >= 10000) dailyScore = 8;
                else if (steps >= 6500) dailyScore = 5;
                else if (steps >= 5200) dailyScore = 2;

                // Note: Image storage removed to prevent Error 400
                // Images are now handled separately or stored as file info only
                let evidenceInfo = '';
                if (evidenceFile) {
                    evidenceInfo = `‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô: ${evidenceFile.name} (${(evidenceFile.size / 1024).toFixed(1)} KB)`;
                    console.log('‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô:', evidenceInfo);
                }

                const now = new Date();
                const thaiDate = now.toLocaleDateString('th-TH', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                const thaiTime = now.toLocaleTimeString('th-TH', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // Upload image if provided
                let evidenceUrl = '';
                if (evidenceFile) {
                    try {
                        evidenceUrl = await uploadImageToImgBB(evidenceFile);
                        console.log('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', evidenceUrl);
                    } catch (error) {
                        console.warn('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', error);
                    }
                }

                // Create record data matching the schema exactly
                const recordData = {
                    empId: String(employeeId).trim(),
                    empName: String(employeeName).trim(),
                    dept: String(department).trim(),
                    stepCount: Number(steps),
                    recordDate: now.toISOString(),
                    approvalStatus: "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
                    score: Number(dailyScore),
                    evidenceUrl: evidenceUrl || ''
                };

                // Log data before sending
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', recordData);
                if (evidenceInfo) {
                    console.log('‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö:', evidenceInfo);
                }

                // Validate data size before sending
                const dataSize = JSON.stringify(recordData).length;
                console.log(`‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${(dataSize / 1024).toFixed(1)} KB`);
                
                if (dataSize > 50000) { // 50KB limit (more conservative)
                    hideLoading();
                    showError("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ\n‚Ä¢ ‡∏•‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û\n‚Ä¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 200KB");
                    return;
                }

                // Check if Data SDK is available
                if (!window.dataSdk || !window.dataSdk.create) {
                    hideLoading();
                    showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
                    return;
                }

                // Save to local Data SDK first
                console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Canva Sheet...');
                const result = await window.dataSdk.create(recordData);
                
                if (result.isOk) {
                    console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Canva Sheet ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    
                    // Send to Google Sheets after successful local save
                    const sheetSuccess = await sendToGoogleSheets({
                        date: thaiDate,
                        time: thaiTime,
                        employee_id: employeeId,
                        employee_name: employeeName,
                        department: department,
                        steps: steps,
                        evidence_url: evidenceUrl || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô',
                        status: "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
                        daily_score: dailyScore,
                        notes: ""
                    });

                    hideLoading();
                    let successMessage = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                    
                    if (sheetSuccess) {
                        successMessage += "\n‚Ä¢ ‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets ‡πÅ‡∏•‡πâ‡∏ß";
                    } else {
                        successMessage += "\n‚Ä¢ Google Sheets ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤";
                    }
                    
                    showSuccess(successMessage);
                    document.getElementById('employee-form').reset();
                    document.getElementById('image-preview').classList.add('hidden');
                } else {
                    hideLoading();
                    console.error('‚ùå Data SDK Error:', result.error);
                    
                    // Provide specific error messages
                    let errorMsg = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                    if (result.error?.message) {
                        if (result.error.message.includes('400')) {
                            errorMsg = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Error 400)\n‚Ä¢ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏à‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ\n‚Ä¢ ‡∏•‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤";
                        } else if (result.error.message.includes('413')) {
                            errorMsg = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (Error 413)\n‚Ä¢ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ\n‚Ä¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤";
                        } else {
                            errorMsg += ": " + result.error.message;
                        }
                    }
                    showError(errorMsg);
                }
            } catch (error) {
                hideLoading();
                console.error('Form submission error:', error);
                showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
            }
        });

        // Admin login
        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const code = document.getElementById('admin-code').value;
            
            if (code === '084843') {
                isAdminLoggedIn = true;
                document.getElementById('admin-login').classList.add('hidden');
                document.getElementById('admin-dashboard').classList.remove('hidden');
                renderAdminTable();
            } else {
                showError("‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            }
        });

        // Admin logout
        function logout() {
            isAdminLoggedIn = false;
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-dashboard').classList.add('hidden');
            document.getElementById('admin-code').value = '';
        }

        // Toggle system
        document.getElementById('toggle-system').addEventListener('click', function() {
            systemEnabled = !systemEnabled;
            const btn = this;
            const statusDiv = document.getElementById('system-status');
            
            if (systemEnabled) {
                btn.textContent = '‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö';
                btn.className = 'px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors';
                statusDiv.className = 'mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center';
                statusDiv.innerHTML = '<span class="text-green-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>';
                showSuccess('‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            } else {
                btn.textContent = '‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö';
                btn.className = 'px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors';
                statusDiv.className = 'mt-6 p-4 bg-red-100 border border-red-300 rounded-lg text-center';
                statusDiv.innerHTML = '<span class="text-red-800 font-medium">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</span>';
                showSuccess('‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
            }
        });

        // Render admin table
        function renderAdminTable() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = '';

            currentRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const date = new Date(record.recordDate);
                const formattedDate = date.toLocaleDateString('th-TH') + ' ' + date.toLocaleTimeString('th-TH');
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-900">${formattedDate}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.empId}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.empName}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.dept}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${record.stepCount.toLocaleString()}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">
                        ${record.evidenceUrl ? 
                            `<a href="${record.evidenceUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 underline">‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</a>` 
                            : '<span class="text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</span>'}
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <select onchange="updateStatus('${record.__backendId}', this.value)" class="px-2 py-1 border rounded text-sm ${getStatusClass(record.approvalStatus)}">
                            <option value="‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.approvalStatus === '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.approvalStatus === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            <option value="‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${record.approvalStatus === '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ? 'selected' : ''}>‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        </select>
                    </td>
                    <td class="px-4 py-3 text-sm text-center font-medium text-blue-600">${record.score}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="text-gray-400 text-xs">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</span>
                    </td>
                    <td class="px-4 py-3 text-sm">
                        <button onclick="deleteRecord('${record.__backendId}')" class="text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50">‡∏•‡∏ö</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (currentRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // Get status class for styling
        function getStatusClass(status) {
            switch(status) {
                case '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': return 'text-green-600 bg-green-50';
                case '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': return 'text-red-600 bg-red-50';
                default: return 'text-yellow-600 bg-yellow-50';
            }
        }

        // Update status
        async function updateStatus(recordId, newStatus) {
            if (!window.dataSdk || !window.dataSdk.update) {
                showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°");
                return;
            }
            
            const record = currentRecords.find(r => r.__backendId === recordId);
            if (record) {
                record.approvalStatus = newStatus;
                const result = await window.dataSdk.update(record);
                if (!result.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ: " + (result.error?.message || 'Unknown error'));
                }
            }
        }

        // Delete record
        async function deleteRecord(recordId) {
            if (!window.dataSdk || !window.dataSdk.delete) {
                showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°");
                return;
            }
            
            const record = currentRecords.find(r => r.__backendId === recordId);
            if (record) {
                const result = await window.dataSdk.delete(record);
                if (!result.isOk) {
                    showError("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: " + (result.error?.message || 'Unknown error'));
                }
            }
        }

        // Clear all data
        async function clearAllData() {
            if (currentRecords.length === 0) {
                showError("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏•‡∏ö");
                return;
            }

            // Create confirmation modal
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmModal.innerHTML = `
                <div class="bg-white rounded-lg p-6 text-center max-w-sm mx-4">
                    <div class="text-red-500 text-5xl mb-4">‚ö†Ô∏è</div>
                    <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <p class="text-gray-600 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${currentRecords.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br><strong class="text-red-600">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</strong></p>
                    <div class="flex gap-3 justify-center">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button onclick="confirmClearAll()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmModal);
        }

        // Confirm clear all data
        async function confirmClearAll() {
            // Remove confirmation modal
            const modal = document.querySelector('.fixed.inset-0');
            if (modal) modal.remove();
            
            if (!window.dataSdk || !window.dataSdk.delete) {
                showError("‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°");
                return;
            }
            
            showLoading();
            
            try {
                let deletedCount = 0;
                const totalRecords = currentRecords.length;
                
                // Delete all records one by one
                for (const record of currentRecords) {
                    try {
                        const result = await window.dataSdk.delete(record);
                        if (result.isOk) {
                            deletedCount++;
                        } else {
                            console.warn('Failed to delete record:', record.__backendId, result.error);
                        }
                    } catch (deleteError) {
                        console.error('Delete error for record:', record.__backendId, deleteError);
                    }
                }
                
                hideLoading();
                
                if (deletedCount === totalRecords) {
                    showSuccess(`‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏•‡∏ö‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${deletedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                } else {
                    showError(`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${deletedCount} ‡∏à‡∏≤‡∏Å ${totalRecords} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                }
                
            } catch (error) {
                hideLoading();
                showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + error.message);
            }
        }

        // Make confirmClearAll available globally
        window.confirmClearAll = confirmClearAll;

        // Export to Excel function
        async function exportToExcel() {
            if (currentRecords.length === 0) {
                showError("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å");
                return;
            }

            try {
                // Prepare data for Excel
                const excelData = [];
                
                // Add header row
                excelData.push([
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                    '‡πÄ‡∏ß‡∏•‡∏≤',
                    '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                    '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
                    '‡πÅ‡∏ú‡∏ô‡∏Å',
                    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πâ‡∏≤‡∏ß',
                    '‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô',
                    '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                    '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô',
                    '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏'
                ]);

                // Add data rows
                currentRecords.forEach(record => {
                    const date = new Date(record.recordDate);
                    const formattedDate = date.toLocaleDateString('th-TH');
                    const formattedTime = date.toLocaleTimeString('th-TH');
                    
                    excelData.push([
                        formattedDate,
                        formattedTime,
                        record.empId,
                        record.empName,
                        record.dept,
                        record.stepCount,
                        record.evidenceUrl ? '‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô',
                        record.approvalStatus,
                        record.score,
                        record.note || ''
                    ]);
                });

                // Create CSV content
                const csvContent = excelData.map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');

                // Add BOM for Thai characters
                const BOM = '\uFEFF';
                const csvWithBOM = BOM + csvContent;

                // Create and download file
                const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    
                    // Generate filename with current date
                    const now = new Date();
                    const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
                    const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-'); // HH-MM-SS
                    const filename = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô_${dateStr}_${timeStr}.csv`;
                    
                    link.setAttribute('download', filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showSuccess(`‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡πÑ‡∏ü‡∏•‡πå: ${filename}\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${currentRecords.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                } else {
                    throw new Error('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå');
                }

            } catch (error) {
                console.error('Export error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            }
        }

        // Export ranking to Excel
        async function exportRankingToExcel() {
            try {
                // Filter approved records only
                const approvedRecords = currentRecords.filter(record => record.approvalStatus === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                
                if (approvedRecords.length === 0) {
                    showError("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å");
                    return;
                }

                // Group by employee and calculate totals
                const employeeStats = {};
                const today = new Date().toDateString();

                approvedRecords.forEach(record => {
                    const empId = record.empId;
                    if (!employeeStats[empId]) {
                        employeeStats[empId] = {
                            employee_id: empId,
                            employee_name: record.empName,
                            department: record.dept,
                            total_score: 0,
                            total_steps: 0,
                            today_steps: 0,
                            record_count: 0
                        };
                    }
                    
                    employeeStats[empId].total_score += record.score;
                    employeeStats[empId].total_steps += record.stepCount;
                    employeeStats[empId].record_count += 1;
                    
                    const recordDate = new Date(record.recordDate).toDateString();
                    if (recordDate === today) {
                        employeeStats[empId].today_steps += record.stepCount;
                    }
                });

                // Convert to array and sort by total score
                const sortedEmployees = Object.values(employeeStats)
                    .sort((a, b) => b.total_score - a.total_score);

                // Prepare Excel data
                const excelData = [];
                
                // Add header row
                excelData.push([
                    '‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö',
                    '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
                    '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•',
                    '‡πÅ‡∏ú‡∏ô‡∏Å',
                    '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°',
                    '‡∏¢‡∏≠‡∏î‡∏Å‡πâ‡∏≤‡∏ß‡∏£‡∏ß‡∏°',
                    '‡∏Å‡πâ‡∏≤‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
                ]);

                // Add data rows
                sortedEmployees.forEach((employee, index) => {
                    excelData.push([
                        index + 1,
                        employee.employee_id,
                        employee.employee_name,
                        employee.department,
                        employee.total_score,
                        employee.total_steps,
                        employee.today_steps,
                        employee.record_count
                    ]);
                });

                // Create CSV content
                const csvContent = excelData.map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');

                // Add BOM for Thai characters
                const BOM = '\uFEFF';
                const csvWithBOM = BOM + csvContent;

                // Create and download file
                const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    
                    // Generate filename with current date
                    const now = new Date();
                    const dateStr = now.toISOString().split('T')[0];
                    const filename = `‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô_${dateStr}.csv`;
                    
                    link.setAttribute('download', filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showSuccess(`‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡πÑ‡∏ü‡∏•‡πå: ${filename}\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${sortedEmployees.length} ‡∏Ñ‡∏ô`);
                } else {
                    throw new Error('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå');
                }

            } catch (error) {
                console.error('Export ranking error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö: ' + error.message);
            }
        }

        // Render ranking table
        function renderRankingTable() {
            const tbody = document.getElementById('ranking-table-body');
            tbody.innerHTML = '';

            // Filter approved records only
            const approvedRecords = currentRecords.filter(record => record.approvalStatus === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
            
            // Group by employee and calculate totals
            const employeeStats = {};
            const today = new Date().toDateString();

            approvedRecords.forEach(record => {
                const empId = record.empId;
                if (!employeeStats[empId]) {
                    employeeStats[empId] = {
                        employee_id: empId,
                        employee_name: record.empName,
                        department: record.dept,
                        total_score: 0,
                        total_steps: 0,
                        today_steps: 0
                    };
                }
                
                employeeStats[empId].total_score += record.score;
                employeeStats[empId].total_steps += record.stepCount;
                
                const recordDate = new Date(record.recordDate).toDateString();
                if (recordDate === today) {
                    employeeStats[empId].today_steps += record.stepCount;
                }
            });

            // Convert to array and sort by total score
            const sortedEmployees = Object.values(employeeStats)
                .sort((a, b) => b.total_score - a.total_score)
                .slice(0, 100);

            sortedEmployees.forEach((employee, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                let rankDisplay = rank;
                if (rank === 1) rankDisplay = '<span class="medal-gold text-2xl">ü•á</span> 1';
                else if (rank === 2) rankDisplay = '<span class="medal-silver text-2xl">ü•à</span> 2';
                else if (rank === 3) rankDisplay = '<span class="medal-bronze text-2xl">ü•â</span> 3';
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-center font-bold ${rank <= 3 ? 'text-lg' : ''}">${rankDisplay}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${employee.employee_id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 font-medium">${employee.employee_name}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${employee.department}</td>
                    <td class="px-4 py-3 text-center text-sm font-bold text-blue-600">${employee.total_score}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900">${employee.total_steps.toLocaleString()}</td>
                    <td class="px-4 py-3 text-center text-sm text-gray-900">${employee.today_steps.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });

            if (sortedEmployees.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // View image in modal
        function viewImage(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageUrl}" class="max-w-full max-h-full object-contain rounded-lg" onerror="this.parentElement.innerHTML='<div class=\\'text-white text-center\\'>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</div>'">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-4 right-4 text-white text-3xl hover:text-gray-300 bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center">√ó</button>
                </div>
            `;
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            document.body.appendChild(modal);
        }

        // Utility functions
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function showLoading() {
            document.getElementById('loading-modal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-modal').classList.add('hidden');
        }

        function showSuccess(message) {
            document.getElementById('success-message').textContent = message;
            document.getElementById('success-modal').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-modal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Check system status
        async function checkSystemStatus() {
            const btn = document.getElementById('check-system-btn');
            const resultsDiv = document.getElementById('system-check-results');
            const contentDiv = document.getElementById('check-results-content');
            
            btn.disabled = true;
            btn.innerHTML = '<div class="loading inline-block mr-2"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            
            try {
                const results = await testSystemConnectivity();
                
                let html = '<div class="space-y-2">';
                
                // System Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</span>
                    <span class="${results.dataSdk ? 'text-green-600' : 'text-red-600'}">
                        ${results.dataSdk ? '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'}
                    </span>
                </div>`;
                
                // Google Sheets Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets:</span>
                    <span class="${results.googleSheets ? 'text-green-600' : 'text-red-600'}">
                        ${results.googleSheets ? '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ' : '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠'}
                    </span>
                </div>`;
                
                // Image Upload Status
                html += `<div class="flex items-center justify-between">
                    <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</span>
                    <span class="text-green-600">
                        ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà (‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                    </span>
                </div>`;
                
                html += '</div>';
                
                // Overall status
                const allGood = results.dataSdk && results.googleSheets;
                html += `<div class="mt-3 p-3 rounded-lg ${allGood ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                    <strong>${allGood ? '‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô'}</strong><br>
                    ${allGood ? 
                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Canva Sheet ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets' : 
                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Canva Sheet ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (Google Sheets ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤)'}
                </div>`;
                
                // Instructions
                if (!results.googleSheets) {
                    html += `<div class="mt-3 p-3 bg-blue-100 text-blue-800 rounded-lg text-xs">
                        <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Google Sheets:</strong><br>
                        1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script<br>
                        2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Form ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Sheet<br>
                        3. ‡πÉ‡∏ä‡πâ Zapier ‡∏´‡∏£‡∏∑‡∏≠ IFTTT Webhook<br>
                        <a href="https://docs.google.com/spreadsheets/d/${SHEET_ID}/edit#gid=0" target="_blank" class="underline">‡πÄ‡∏õ‡∏¥‡∏î Google Sheet</a>
                    </div>`;
                }
                
                contentDiv.innerHTML = html;
                resultsDiv.classList.remove('hidden');
                
            } catch (error) {
                contentDiv.innerHTML = `<div class="text-red-600">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${error.message}</div>`;
                resultsDiv.classList.remove('hidden');
            }
            
            btn.disabled = false;
            btn.innerHTML = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà)
        async function processImageForStorage(file) {
            return new Promise((resolve, reject) => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏° php.ini (8MB)
                const MAX_FILE_SIZE = 8 * 1024 * 1024; // 8MB
                if (file.size > MAX_FILE_SIZE) {
                    reject(new Error(`‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${MAX_FILE_SIZE / 1024 / 1024} MB`));
                    return;
                }

                console.log(`üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);

                const reader = new FileReader();
                reader.readAsDataURL(file);
                
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            let width = img.width;
                            let height = img.height;
                            
                            console.log(`üñºÔ∏è ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö: ${width}x${height}`);
                            
                            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ï‡∏≤‡∏° GD library pattern)
                            let maxDimension = 2000; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 2000px
                            let quality = 0.85; // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 85%
                            
                            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
                            if (file.size > 5 * 1024 * 1024) { // > 5MB
                                maxDimension = 1200;
                                quality = 0.7;
                            } else if (file.size > 2 * 1024 * 1024) { // > 2MB
                                maxDimension = 1600;
                                quality = 0.75;
                            }
                            
                            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô
                            if (width > maxDimension || height > maxDimension) {
                                if (width > height) {
                                    height = Math.round((height * maxDimension) / width);
                                    width = maxDimension;
                                } else {
                                    width = Math.round((width * maxDimension) / height);
                                    height = maxDimension;
                                }
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£ render
                            ctx.imageSmoothingEnabled = true;
                            ctx.imageSmoothingQuality = 'high';
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            console.log(`üîß ‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö: ${width}x${height}, ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û: ${(quality * 100)}%`);
                            
                            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JPEG
                            let compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                            let currentSizeKB = (compressedBase64.length / 1024);
                            console.log(`üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ${currentSizeKB.toFixed(1)} KB`);
                            
                            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 150KB ‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
                            if (compressedBase64.length > 150000 && quality > 0.5) {
                                quality = 0.6;
                                compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                                currentSizeKB = (compressedBase64.length / 1024);
                                console.log(`üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ${currentSizeKB.toFixed(1)} KB (‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û ${(quality * 100)}%)`);
                            }
                            
                            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100KB ‡πÉ‡∏´‡πâ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                            if (compressedBase64.length > 100000) {
                                const newWidth = Math.round(width * 0.8);
                                const newHeight = Math.round(height * 0.8);
                                
                                canvas.width = newWidth;
                                canvas.height = newHeight;
                                ctx.imageSmoothingEnabled = true;
                                ctx.imageSmoothingQuality = 'high';
                                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                                
                                compressedBase64 = canvas.toDataURL('image/jpeg', 0.5);
                                currentSizeKB = (compressedBase64.length / 1024);
                                console.log(`üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ${currentSizeKB.toFixed(1)} KB (${newWidth}x${newHeight})`);
                            }
                            
                            // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 80KB ‡πÉ‡∏´‡πâ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                            if (compressedBase64.length > 80000) {
                                const newWidth = Math.round(width * 0.6);
                                const newHeight = Math.round(height * 0.6);
                                
                                canvas.width = newWidth;
                                canvas.height = newHeight;
                                ctx.imageSmoothingEnabled = true;
                                ctx.imageSmoothingQuality = 'medium';
                                ctx.drawImage(img, 0, 0, newWidth, newHeight);
                                
                                compressedBase64 = canvas.toDataURL('image/jpeg', 0.4);
                                currentSizeKB = (compressedBase64.length / 1024);
                                console.log(`üìä ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ${currentSizeKB.toFixed(1)} KB (${newWidth}x${newHeight})`);
                            }
                            
                            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î
                            const originalSizeKB = (file.size / 1024);
                            const compressionRatio = ((1 - currentSizeKB / originalSizeKB) * 100);
                            
                            console.log(`‚úÖ ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${currentSizeKB.toFixed(1)} KB (‡∏•‡∏î‡∏•‡∏á ${compressionRatio.toFixed(1)}%)`);
                            
                            // ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà
                            if (compressedBase64.length > 120000) { // > 120KB
                                console.warn(`‚ö†Ô∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏¢‡∏±‡∏á‡πÉ‡∏´‡∏ç‡πà (${currentSizeKB.toFixed(1)} KB) ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`);
                            }
                            
                            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
                            if (compressedBase64.length > 200000) { // > 200KB
                                reject(new Error(`‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (${currentSizeKB.toFixed(1)} KB)\n‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡πÑ‡∏î‡πâ\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤\n‚Ä¢ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î`));
                                return;
                            }
                            
                            resolve(compressedBase64);
                            
                        } catch (canvasError) {
                            console.error('Canvas processing error:', canvasError);
                            reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ: ' + canvasError.message));
                        }
                    };
                    
                    img.onerror = () => {
                        reject(new Error('‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'));
                    };
                };
                
                reader.onerror = () => {
                    reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'));
                };
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        async function compressImage(file, maxWidth = 800, maxHeight = 600, quality = 0.7) {
            try {
                return await processImageForStorage(file);
            } catch (error) {
                console.error('Image compression failed:', error);
                // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
                return '';
            }
        }

        // Test function for debugging Data SDK
        async function testSimpleRecord() {
            const testData = {
                empId: "001",
                empName: "‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
                dept: "IT",
                stepCount: 5000,
                recordDate: new Date().toISOString(),
                approvalStatus: "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
                score: 2
            };
            
            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:', testData);
            
            try {
                const result = await window.dataSdk.create(testData);
                
                if (result.isOk) {
                    console.log('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    showSuccess('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } else {
                    console.error('‚ùå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:', result.error);
                    showError('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + JSON.stringify(result.error));
                }
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }

        // Show server configuration guide
        function showServerConfig() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-5xl max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Error 400 (Bad Request) - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                    
                    <div class="mb-4 p-4 bg-red-100 border border-red-300 rounded-lg">
                        <h4 class="font-bold text-red-800 mb-2">‚ùó ‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á Error 400 (Bad Request)</h4>
                        <p class="text-red-700 text-sm">‡∏°‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô 3 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ üëá</p>
                    </div>
                    
                    <div class="space-y-6 text-sm">
                        <!-- Step 1: PHP Settings -->
                        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-blue-800 mb-3">üîç 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô PHP (php.ini)</h4>
                            <p class="text-blue-700 mb-3">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå <code class="bg-blue-200 px-1 rounded">php.ini</code> ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:</p>
                            <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto mb-3">
upload_max_filesize = 8M<br>
post_max_size = 8M<br>
max_execution_time = 60<br>
max_input_time = 60
                            </div>
                            <div class="bg-yellow-100 border border-yellow-300 p-3 rounded mb-3">
                                <p class="text-yellow-800 font-medium">‚úÖ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8M</p>
                                <p class="text-red-700 font-medium">‚ùó ‡∏ñ‡πâ‡∏≤ post_max_size ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤ upload_max_filesize ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏≠‡∏ö 400 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                            </div>
                            <div class="space-y-2">
                                <p class="font-medium text-blue-800">‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏ï‡πâ‡∏≠‡∏á ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó Apache ‡∏´‡∏£‡∏∑‡∏≠ XAMPP:</p>
                                <p class="text-blue-700">‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ XAMPP ‚Üí Stop ‡πÅ‡∏•‡∏∞ Start "Apache" ‡πÉ‡∏´‡∏°‡πà</p>
                                <p class="text-blue-700">‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Linux ‚Üí <code class="bg-gray-200 px-1 rounded">sudo systemctl restart apache2</code></p>
                            </div>
                            <div class="mt-3 p-3 bg-green-100 border border-green-300 rounded">
                                <p class="font-medium text-green-800">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå phpinfo.php:</p>
                                <div class="bg-gray-800 text-green-400 p-2 rounded font-mono text-xs mt-2">
&lt;?php phpinfo(); ?&gt;
                                </div>
                                <p class="text-green-700 text-xs mt-2">‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤ upload_max_filesize ‡∏Å‡∏±‡∏ö post_max_size ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á</p>
                            </div>
                        </div>

                        <!-- Step 2: Web Server Settings -->
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                            <h4 class="font-bold text-green-800 mb-3">üß± 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°</h4>
                            
                            <!-- Apache -->
                            <div class="mb-4">
                                <p class="font-medium text-green-800 mb-2">üëâ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Apache:</p>
                                <p class="text-green-700 mb-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå <code class="bg-green-200 px-1 rounded">.htaccess</code> (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö PHP) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ:</p>
                                <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto mb-2">
php_value upload_max_filesize 8M<br>
php_value post_max_size 8M
                                </div>
                                <div class="bg-red-100 border border-red-300 p-2 rounded">
                                    <p class="text-red-700 text-xs">‡∏ñ‡πâ‡∏≤ Apache ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á php_value (‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô 500 Error)<br>
                                    ‚Üí ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ‡πÉ‡∏ô php.ini ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
                                </div>
                            </div>

                            <!-- Nginx -->
                            <div class="mb-4">
                                <p class="font-medium text-green-800 mb-2">üëâ ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Nginx:</p>
                                <p class="text-green-700 mb-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå <code class="bg-green-200 px-1 rounded">/etc/nginx/nginx.conf</code> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå site ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å server:</p>
                                <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto mb-2">
server {<br>
&nbsp;&nbsp;&nbsp;&nbsp;client_max_body_size 8M;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# ... other settings<br>
}
                                </div>
                                <p class="text-green-700">‡πÅ‡∏•‡πâ‡∏ß <code class="bg-gray-200 px-1 rounded">sudo systemctl reload nginx</code></p>
                            </div>
                        </div>

                        <!-- Step 3: Form Validation -->
                        <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                            <h4 class="font-bold text-purple-800 mb-3">üß© 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°</h4>
                            <p class="text-purple-700 mb-2">‡πÉ‡∏ô <code class="bg-purple-200 px-1 rounded">&lt;form&gt;</code> ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ:</p>
                            <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto mb-3">
&lt;form action="upload.php" method="post" enctype="multipart/form-data"&gt;
                            </div>
                            <div class="bg-red-100 border border-red-300 p-3 rounded">
                                <p class="text-red-700 font-medium">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ <code class="bg-red-200 px-1 rounded">enctype="multipart/form-data"</code></p>
                                <p class="text-red-700">‚Üí PHP ‡∏à‡∏∞‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ($_FILES ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)</p>
                                <p class="text-red-700">‚Üí ‡πÅ‡∏•‡∏∞‡∏ö‡∏≤‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö 400 Bad Request ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                            </div>
                        </div>

                        <!-- Step 4: PHP Test Code -->
                        <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-500">
                            <h4 class="font-bold text-orange-800 mb-3">üßæ 4. ‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏Ñ‡πâ‡∏î PHP ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå</h4>
                            <p class="text-orange-700 mb-2">‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ PHP ‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°:</p>
                            <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto mb-3">
&lt;?php<br>
if ($_SERVER['REQUEST_METHOD'] === 'POST') {<br>
&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;pre&gt;';<br>
&nbsp;&nbsp;&nbsp;&nbsp;print_r($_FILES);<br>
&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;/pre&gt;';<br>
} else {<br>
?&gt;<br>
&lt;form method="post" enctype="multipart/form-data"&gt;<br>
&nbsp;&nbsp;&lt;input type="file" name="file"&gt;<br>
&nbsp;&nbsp;&lt;button type="submit"&gt;Upload&lt;/button&gt;<br>
&lt;/form&gt;<br>
&lt;?php } ?&gt;
                            </div>
                            <div class="space-y-2">
                                <p class="text-orange-700">‚Ä¢ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏•‡πá‡∏Å ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô < 500 KB)</p>
                                <p class="text-green-700">‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‚Üí PHP ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å</p>
                                <p class="text-red-700">‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ "Error 400" ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‚Üí ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ Apache ‡∏´‡∏£‡∏∑‡∏≠ PHP ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò request ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå</p>
                            </div>
                        </div>

                        <!-- Step 5: Log Files -->
                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-500">
                            <h4 class="font-bold text-yellow-800 mb-3">üß† 5. ‡∏ï‡∏£‡∏ß‡∏à log</h4>
                            <p class="text-yellow-700 mb-2">‡πÄ‡∏ä‡πá‡∏Å‡πÑ‡∏ü‡∏•‡πå log ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</p>
                            <div class="space-y-2 mb-3">
                                <p class="text-yellow-700">‚Ä¢ <strong>XAMPP:</strong> <code class="bg-yellow-200 px-1 rounded">xampp/apache/logs/error.log</code></p>
                                <p class="text-yellow-700">‚Ä¢ <strong>Apache (Linux):</strong> <code class="bg-yellow-200 px-1 rounded">/var/log/apache2/error.log</code></p>
                                <p class="text-yellow-700">‚Ä¢ <strong>Nginx:</strong> <code class="bg-yellow-200 px-1 rounded">/var/log/nginx/error.log</code></p>
                            </div>
                            <p class="text-yellow-700 mb-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ä‡∏±‡∏î ‡πÄ‡∏ä‡πà‡∏ô:</p>
                            <div class="bg-gray-800 text-red-400 p-3 rounded font-mono text-xs overflow-x-auto">
Request Entity Too Large<br>
mod_security: Access denied<br>
POST Content-Length of 5234567 bytes exceeds limit of 2097152 bytes
                            </div>
                        </div>

                        <!-- Step 6: Temporary Solution -->
                        <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-500">
                            <h4 class="font-bold text-indigo-800 mb-3">üß∞ 6. ‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö)</h4>
                            <p class="text-indigo-700 mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô <code class="bg-indigo-200 px-1 rounded">upload.php</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ PHP ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà:</p>
                            <div class="bg-gray-800 text-green-400 p-3 rounded font-mono text-xs overflow-x-auto">
ini_set('upload_max_filesize', '8M');<br>
ini_set('post_max_size', '8M');<br>
ini_set('max_input_time', '60');<br>
ini_set('max_execution_time', '60');
                            </div>
                        </div>

                        <!-- Quick Diagnostic -->
                        <div class="bg-gray-50 p-4 rounded-lg border-2 border-gray-300">
                            <h4 class="font-bold text-gray-800 mb-3">üîß ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏î‡πà‡∏ß‡∏ô</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                <div class="space-y-2">
                                    <p class="font-medium text-gray-800">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</p>
                                    <p class="text-gray-700">1. ‡πÅ‡∏Å‡πâ php.ini ‚Üí ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó Apache</p>
                                    <p class="text-gray-700">2. ‡∏ï‡∏£‡∏ß‡∏à phpinfo() ‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                                    <p class="text-gray-700">3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å (< 1MB)</p>
                                    <p class="text-gray-700">4. ‡∏î‡∏π error log ‡∏´‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏</p>
                                    <p class="text-gray-700">5. ‡πÉ‡∏ä‡πâ ini_set() ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</p>
                                </div>
                                <div class="space-y-2">
                                    <p class="font-medium text-gray-800">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á:</p>
                                    <p class="text-red-600">‚Ä¢ Error 400 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</p>
                                    <p class="text-red-600">‚Ä¢ $_FILES ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
                                    <p class="text-red-600">‚Ä¢ ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ñ‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠ timeout</p>
                                    <p class="text-red-600">‚Ä¢ ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button onclick="this.parentElement.parentElement.remove()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            ‡∏õ‡∏¥‡∏î
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        // Make test function available globally for console testing
        window.testSimpleRecord = testSimpleRecord;

        // Show SDK loading status
        function showSDKStatus() {
            const statusDiv = document.getElementById('system-status');
            if (statusDiv) {
                if (!window.dataSdk) {
                    statusDiv.className = 'mt-6 p-4 bg-yellow-100 border border-yellow-300 rounded-lg text-center';
                    statusDiv.innerHTML = '<span class="text-yellow-800 font-medium">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö...</span>';
                } else {
                    statusDiv.className = 'mt-6 p-4 bg-green-100 border border-green-300 rounded-lg text-center';
                    statusDiv.innerHTML = '<span class="text-green-800 font-medium">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>';
                }
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            showSDKStatus();
            initializeApp();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'991f33112705894b',t:'MTc2MTAzMzM5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
